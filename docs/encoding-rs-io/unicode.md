# Unicode 常见字符编码规则

Unicode （统一码、万国码）是国际标准字符集，它将世界各种语言的每个字符定义一个唯一的编码，以满足跨语言、跨平台的文本信息转换；

> 字符集即字符的集合，除了 Unicode 还有 ASCII、GB2312 等等。

Unicode 字符集的编码范围是 `0x0000 - 0x10FFFF`, 可以容纳一百多万个字符， 每个字符都有一个独一无二的编码，也即每个字符都有一个二进制数值和它对应，这里的二进制数值也叫 **码点**。

**Unicode 中的常见编码格式**：

+ **UTF-8 (Unicode Transformation Format - 8-bit)**:

  使用一至四个字节对字符进行编码，适用于Web和大多数操作系统。

+ **UTF-16 (Unicode Transformation Format - 16-bit)**:

  使用两个或四个字节对字符进行编码，分为大端序（BE）和小端序（LE）。

+ **UTF-32 (Unicode Transformation Format - 32-bit)**:

​		使用固定四个字节对字符进行编码，每个码点直接映射到四个字节。

+ **SCSU (Standard Compression Scheme for Unicode)**:

​		一种压缩编码格式，用于减少Unicode数据的存储空间。

**UTF-8编码原理**：

UTF-8: 是一种变长字符编码，将码点编码为 1 至 4 个字节。

UTF-8 的编码规则:

1. 对于单字节的符号，字节的第一位设为 0，后面 7 位为这个符号的 Unicode 码。因此对于英语字母，UTF-8 编码和 ASCII 码是相同的, 所以 UTF-8 能兼容 ASCII 编码，这也是互联网普遍采用 UTF-8 的原因之一

   > 比如 “foobar” UTF-8 编码是：666F6F626172，和 ASCII 编码一样。

2. 对于 n 字节的符号（ n > 1），第一个字节的前 n 位都设为 1，第 n + 1 位设为 0，后面字节的前两位一律设为 10 。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码

   > 比如 “中国” UTF-8 编码是：E4B8ADE59BBD，
   >
   > “中” 占用3个字节，E4B8AD (11100100 10111000 10101101)，
   >
   > 第一个字节 E4 (11100100) 前3位为1表示“中”占用3个字节，第4位设置为0表示占用字节数的位结束；除去后面两个字节开头的10，剩余空间存储这个字的 Unicode 码（即 0100 111000 101101）。
   >
   > 每个字符在 Unicode 中都有一个唯一的编码。

**UTF-16编码原理**：

UTF-16 也是一种变长字符编码，将字符编码成 2 字节 或者 4 字节。

UTF-16 有两种字节序：LE 小端字节序（低位字节在前、高位字节在后，字节序标记是 FFFE），BE 大端字节序列（高位字节在前，低位字节在后，默认，字节序标记是 FEFF）, 可以使用 **BOM** (byte-order mark) 字节序标记进行标记。

> ```rust
> // "foobar" 的 utf-16-le 编码
> // \xFF\xFE 是字节序标记，f\x00 是 'f' 的编码，后面依次类推
> let source_data = &b"\xFF\xFEf\x00o\x00o\x00b\x00a\x00r\x00"[..];
> ```

UTF-16 的编码规则:

1. 对于 Unicode 码小于 0x10000 的字符， 使用 2 个字节存储，并且是直接存储 Unicode 码，不用进行编码转换
2. 对于 Unicode 码在 0x10000 和 0x10FFFF 之间的字符，使用 4 个字节存储，这 4 个字节分成前后两部分，每个部分各两个字节，其中，前面两个字节的前 6 位二进制固定为 110110，后面两个字节的前 6 位二进制固定为 110111, 前后部分各剩余 10 位二进制表示符号的 Unicode 码 减去 0x10000 的结果
3. 大于 0x10FFFF 的 Unicode 码无法用 UTF-16 编码

> 比如“中国” 的 UTF-16LE 编码是： 2D4EFD56 （这两个字的Unicode码均小于 0x10000），
>
> “中” 占用2个字节，2D4E (00101101 01001110)，
>
> “中” 对应的 UTF-16BE 编码是 4E2D (01001110 00101101)。

**UTF-8 和 UTF-16 之间的转换**：

它们使用相同的Unicode编码，然后根据编码规则转换即可。

1字节的UTF-8 Unicode 存储位数是 7,

2字节的UTF-8 Unicode 存储位数是 11, 

3字节的UTF-8 Unicode 存储位数是 16,  上面三种长度的 UTF-8 字符都会转成 2字节的 UTF-16

4 字节的UTF-8 Unicode 存储位数是 21

